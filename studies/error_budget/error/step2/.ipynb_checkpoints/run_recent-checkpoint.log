/System/Volumes/Data/mnt/g2/scratch/bpeck/mcao/vismcao/maos -o error_budget/step2 -c A_vismcao.conf plot.all=1 plot.setup=1 -O dm.dx = [0.154 0.168 0.168] powfs.nwfs=[8 3 1] powfs.siglev = [29.95 128116.75 41.56] powfs.bkgrnd=[0.1 2.6 0.0] powfs.nearecon=[278.71 1.37 202.52] wfs.thetax=[30.0 21.21 0.0 -21.21 -30.0 -21.21 -0.0 21.21 30.0 -15.0 -15.0 0] wfs.thetay=[0.0 21.21 30.0 21.21 0.0 -21.21 -30.0 -21.21 0.0 25.98 -25.98 0] powfs0_llt.ox = [1.0 0.71 0.0 -0.71 -1.0 -0.71 -0.0 0.71]*6.5 powfs0_llt.oy=[0.0 0.71 1.0 0.71 0.0 -0.71 -1.0 -0.71]*6.5 fit.fov=30 tomo.maxit=40 sim.end=1600 sim.closeloop=0 atm.frozenflow=1 powfs.phystep=-1 powfs.noisy=0 sim.eptwfs=0 tomo.alg=0 fit.alg=0 
Output folder is 'error_budget/step2'.
SRC: /u/bpeck/code/maos v2.9 2.9
BUILT: /u/bpeck/code/maos/build by CLANG (v14.0.0) on 2024/03/22 14:52:24 CPU(F64,+O3) w/o CUDA
Launched at 2024/08/26 12:30:07 in dragon with PID 67293.
The web based job monitor can be accessed at http://localhost:10300
Main config file is /System/Volumes/Data/mnt/g2/scratch/bpeck/mcao/vismcao/A_vismcao.conf
Warning(path.c:48): Path not found: path=/System/Volumes/Data/mnt/g2/scratch/bpeck/mcao/vismcao/bin; abspath=/System/Volumes/Data/mnt/g2/scratch/bpeck/mcao/vismcao/bin; Ignored.
Warning(path.c:48): Path not found: path=/System/Volumes/Data/mnt/g2/scratch/bpeck/mcao/vismcao/atm; abspath=/System/Volumes/Data/mnt/g2/scratch/bpeck/mcao/vismcao/atm; Ignored.
Warning(readcfg.c:399): sim.apfsm has been renamed to powfs.apfsm.
Warning(readcfg.c:399): sim.epfsm has been renamed to powfs.epfsm.
Warning(readcfg.c:399): sim.alfsm has been renamed to powfs.alfsm.
Warning(readcfg.c:399): sim.commonfsm has been renamed to powfs.commonfsm.
Warning(readcfg.c:399): sim.idealfsm has been renamed to powfs.idealfsm.
Warning(readcfg.c:399): sim.zetafsm has been renamed to powfs.zetafsm.
Warning(readcfg.c:399): sim.f0fsm has been renamed to powfs.f0fsm.
Warning(readcfg.c:399): tsurf has been renamed to ncpa.tsurf.
loaded 132 (132 new) records from '/System/Volumes/Data/mnt/g2/scratch/bpeck/mcao/vismcao/./keck_sim.conf'
loaded  19 ( 19 new) records from '/System/Volumes/Data/mnt/g2/scratch/bpeck/mcao/vismcao/./dm_none.conf'
loaded  19 (  0 new) records from '/System/Volumes/Data/mnt/g2/scratch/bpeck/mcao/vismcao/./keck_ASM.conf'
loaded  19 (  0 new) records from '/System/Volumes/Data/mnt/g2/scratch/bpeck/mcao/vismcao/./keck_DM2.conf'
loaded  19 (  0 new) records from '/System/Volumes/Data/mnt/g2/scratch/bpeck/mcao/vismcao/./keck_DM3.conf'
loaded   0 (  0 new) records from '/System/Volumes/Data/mnt/g2/scratch/bpeck/mcao/vismcao/./keck_dm_multiple.conf'
loaded   7 (  5 new) records from '/System/Volumes/Data/mnt/g2/scratch/bpeck/mcao/vismcao/./atm_mk13n50p_ground_detail.conf'
loaded  76 ( 69 new) records from '/u/bpeck/code/maos/config/maos/powfs_common.conf'
loaded  44 ( 38 new) records from '/System/Volumes/Data/mnt/g2/scratch/bpeck/mcao/vismcao/./powfs_none.conf'
loaded  44 (  0 new) records from '/System/Volumes/Data/mnt/g2/scratch/bpeck/mcao/vismcao/./keck_shwfs_lgs.conf'
loaded  44 (  0 new) records from '/System/Volumes/Data/mnt/g2/scratch/bpeck/mcao/vismcao/./keck_shwfs_ttf_strap.conf'
loaded  44 (  0 new) records from '/System/Volumes/Data/mnt/g2/scratch/bpeck/mcao/vismcao/./keck_shwfs_twfs_lbwfs.conf'
loaded   0 (  0 new) records from '/System/Volumes/Data/mnt/g2/scratch/bpeck/mcao/vismcao/./keck_wfs_lgs_strap_lbwfs.conf'
loaded  71 ( 71 new) records from '/System/Volumes/Data/mnt/g2/scratch/bpeck/mcao/vismcao/./keck_recon.conf'
Warning(readcfg.c:399): dbg.na_smooth has been renamed to powfs0_llt.na_smooth.
Warning(readcfg.c:399): dbg.na_interp has been renamed to powfs0_llt.na_interp.
Warning(readcfg.c:399): dbg.na_thres has been renamed to powfs0_llt.na_thres.
Warning(readcfg.c:399): dbg.na_fit_maxit has been renamed to powfs0_llt.na_fit_maxit.
Warning(readcfg.c:399): dbg.na_fit_svdthres has been renamed to powfs0_llt.na_fit_svdthres.
Warning(readcfg.c:399): dbg.na_fit_dh has been renamed to powfs0_llt.na_fit_dh.
Warning(readcfg.c:399): dbg.ncpa_preload has been renamed to ncpa.preload.
Warning(readcfg.c:399): dbg.ncpa_rmsci has been renamed to ncpa.rmsci.
Warning(readcfg.c:399): dbg.draw_opdmax has been renamed to plot.opdmax.
Warning(readcfg.c:399): dbg.draw_gmax has been renamed to plot.gmax.
loaded  95 ( 93 new) records from '/System/Volumes/Data/mnt/g2/scratch/bpeck/mcao/vismcao/./keck_dbg.conf'
loaded   4 (  4 new) records from '/System/Volumes/Data/mnt/g2/scratch/bpeck/mcao/vismcao/./keck_fit_mcao.conf'
Warning(readcfg.c:399): surf has been renamed to ncpa.surf.
loaded  37 (  7 new) records from '/System/Volumes/Data/mnt/g2/scratch/bpeck/mcao/vismcao/A_vismcao.conf'
Overriding plot.all            	0 --> 1
Overriding plot.setup          	0 --> 1
Overriding dm.dx               	[0.154 .168 .168] --> [0.154 0.168 0.168]
Overriding powfs.siglev        	[82.479 42387.592 41.558] --> [29.95 128116.75 41.56]
Overriding powfs.bkgrnd        	[0.1 1.056 0.001] --> [0.1 2.6 0.0]
Overriding powfs.nearecon      	[171.319 0.269 202.516] --> [278.71 1.37 202.52]
Overriding wfs.thetax          	[30.0, 21.21, 0.0, -21.21, -30.0, -21.21, -0.0, 21.21 15 -30 15 0] --> [30.0 21.21 0.0 -21.21 -30.0 -21.21 -0.0 21.21 30.0 -15.0 -15.0 0]
Overriding wfs.thetay          	[0.0, 21.21, 30.0, 21.21, 0.0, -21.21, -30.0, -21.21 25.98 0 -25.98 0] --> [0.0 21.21 30.0 21.21 0.0 -21.21 -30.0 -21.21 0.0 25.98 -25.98 0]
Overriding powfs0_llt.ox       	[1.0, 0.71, 0.0, -0.71, -1.0, -0.71, -0.0, 0.71]*6.5 --> [1.0 0.71 0.0 -0.71 -1.0 -0.71 -0.0 0.71]*6.5
Overriding powfs0_llt.oy       	[0.0, 0.71, 1.0, 0.71, 0.0, -0.71, -1.0, -0.71]*6.5 --> [0.0 0.71 1.0 0.71 0.0 -0.71 -1.0 -0.71]*6.5
Overriding tomo.maxit          	0 --> 40
Overriding sim.closeloop       	1 --> 0
Overriding powfs.phystep       	[0 -1 0] --> -1
Overriding powfs.noisy         	[1] --> 0
Overriding sim.eptwfs          	0.5 --> 0
Overriding tomo.alg            	1 --> 0
Overriding fit.alg             	-1 --> 0
loaded  21 (  0 new) records from 'command line'
loaded  24 ( 18 new) records from '/System/Volumes/Data/mnt/g2/scratch/bpeck/mcao/vismcao/./keck_llt_CL.conf'
draw_helper started
Adjust LGS range by telescope altitude 4145m.
Zenith angle is 30 degree.
    Scaling turbulence height and LGS hs by sec(za).
    Scaling r0 by cos(za)^(3/5).
    Scaling wind speed and LGS signal level by cos(za).
powfs0: Adjusting dx from 0.0078125 to 0.0077. 
powfs0.llt.fsm: f0=0 Hz, LPF ep=0
powfs0.epfsm is set to 0.517618 (auto)
powfs2: Adjusting dx from 0.03125 to 0.0312778. 
powfs2 is TWFS for powfs0
Warning(parms.c:2297): Layer 1 at 17.3205m is very close to layer 0 at 0m (OK).
Warning(parms.c:2297): Layer 2 at 34.641m is very close to layer 1 at 17.3205m (OK).
Warning(parms.c:2297): Layer 3 at 51.9615m is very close to layer 2 at 34.641m (OK).
dm 0: stroke=30 um is provided in micron.
dm 0: assume ia stroke=2 um is provided in micron.
dm 1: stroke=7 um is provided in micron.
dm 1: assume ia stroke=2 um is provided in micron.
dm 2: stroke=7 um is provided in micron.
dm 2: assume ia stroke=2 um is provided in micron.
Focus blending is not implemented yet for integrated tomography
parms->sim.mffocus is reset to 0
There are 1 valid simulation seeds:  1
Output PSF for 10 directions
Used 449 of 456 supplied keys
Warning(readcfg.c:158): key "dbg.pwfs_flate" is not recognized, value is 0
Warning(readcfg.c:158): key "dbg.pwfs_flatv" is not recognized, value is 0
Warning(readcfg.c:158): key "dbg.pwfs_psx" is not recognized, value is [0 0 0 0]
Warning(readcfg.c:158): key "dbg.pwfs_psy" is not recognized, value is [0 0 0 0]
Warning(readcfg.c:158): key "dbg.pwfs_pupelong" is not recognized, value is 0
Warning(readcfg.c:158): key "dbg.pwfs_raw" is not recognized, value is 0
Warning(readcfg.c:158): key "dbg.pwfs_side" is not recognized, value is 4
[00;00mAperture[00;00m is 11 m with sampling 1/128 m
[00;00mTurbulence at 30 degree zenith angle:[00;00m r0=0.128424m, L0=30m, 14 layers.
    Greenwood freq is 25.1Hz, anisoplanatic angle is 1.58 as
    Sampled 8192x8192 at 1/128m. wind dir is randomized.
    layer 0: ht=      0 m, wt= 0.302, ws=  4.8 m/s
    layer 1: ht=     17 m, wt= 0.154, ws=  5.0 m/s
    layer 2: ht=     35 m, wt= 0.041, ws=  5.4 m/s
    layer 3: ht=     52 m, wt= 0.002, ws=  6.6 m/s
    layer 4: ht=    139 m, wt= 0.021, ws=  6.1 m/s
    layer 5: ht=    231 m, wt= 0.010, ws=  6.1 m/s
    layer 6: ht=    323 m, wt= 0.008, ws=  6.1 m/s
    layer 7: ht=    416 m, wt= 0.005, ws=  6.1 m/s
    layer 8: ht=    508 m, wt= 0.001, ws=  6.1 m/s
    layer 9: ht=    932 m, wt= 0.107, ws=  5.6 m/s
    layer 10: ht=   5022 m, wt= 0.144, ws= 11.1 m/s
    layer 11: ht=   9238 m, wt= 0.093, ws= 19.1 m/s
    layer 12: ht=  13856 m, wt= 0.075, ws=  8.2 m/s
    layer 13: ht=  22518 m, wt= 0.036, ws=  4.8 m/s
[00;00mReconstruction[00;00m: r0=0.128424m L0=30m. 14 layers. use cone coordinate.
    layer 0: ht=      0 m, wt= 0.302
    layer 1: ht=     17 m, wt= 0.154
    layer 2: ht=     35 m, wt= 0.041
    layer 3: ht=     52 m, wt= 0.002
    layer 4: ht=    139 m, wt= 0.021
    layer 5: ht=    231 m, wt= 0.010
    layer 6: ht=    323 m, wt= 0.008
    layer 7: ht=    416 m, wt= 0.005
    layer 8: ht=    508 m, wt= 0.001
    layer 9: ht=    932 m, wt= 0.107
    layer 10: ht=   5022 m, wt= 0.144
    layer 11: ht=   9238 m, wt= 0.093
    layer 12: ht=  13856 m, wt= 0.075
    layer 13: ht=  22518 m, wt= 0.036
[00;00mThere are 3 powfs[00;00m
  powfs0: Order 72, LGS at 99.1 km. Sampling 1/129.87 m. Thres 30%. [00;00mT/T is removed in right hand side in tomography.[00;00m
    Gtilt in reconstruction. Geomtric optics start at 0 with gtilt [01;31m(noise free)[00;00m
  powfs1: Order  2, NGS at inf km. Sampling 1/16 m. Thres 30%. 
    Ztilt in reconstruction. Geomtric optics start at 0 with ztilt [01;31m(noise free)[00;00m
  powfs2: Order 20, NGS at inf km. Sampling 1/31.9716 m. Thres 50%. 
    Gtilt in reconstruction. Geomtric optics start at 0 with gtilt [01;31m(noise free)[00;00m
[00;00mThere are 12 wfs[00;00m
    wfs 0: type 0, at (  30.00,    0.00) arcsec,  99 km, siglev is 25.9375 bkgrnd is 0.1
    wfs 1: type 0, at (  21.21,   21.21) arcsec,  99 km, siglev is 25.9375 bkgrnd is 0.1
    wfs 2: type 0, at (   0.00,   30.00) arcsec,  99 km, siglev is 25.9375 bkgrnd is 0.1
    wfs 3: type 0, at ( -21.21,   21.21) arcsec,  99 km, siglev is 25.9375 bkgrnd is 0.1
    wfs 4: type 0, at ( -30.00,    0.00) arcsec,  99 km, siglev is 25.9375 bkgrnd is 0.1
    wfs 5: type 0, at ( -21.21,  -21.21) arcsec,  99 km, siglev is 25.9375 bkgrnd is 0.1
    wfs 6: type 0, at (   0.00,  -30.00) arcsec,  99 km, siglev is 25.9375 bkgrnd is 0.1
    wfs 7: type 0, at (  21.21,  -21.21) arcsec,  99 km, siglev is 25.9375 bkgrnd is 0.1
    wfs 8: type 1, at (  30.00,    0.00) arcsec, inf km, siglev is 128117 bkgrnd is 2.6
    wfs 9: type 1, at ( -15.00,   25.98) arcsec, inf km, siglev is 128117 bkgrnd is 2.6
    wfs 10: type 1, at ( -15.00,  -25.98) arcsec, inf km, siglev is 128117 bkgrnd is 2.6
    wfs 11: type 2, at (   0.00,    0.00) arcsec, inf km, siglev is 41.56 bkgrnd is 0
[00;00mThere are 3 DMs[00;00m
  DM 0 at -0.1km, actuator pitch 0.154m, offset   0, with 30.000000 micron stroke.
    Normalized cubic influence function with inter-actuator coupling of 0.223
  DM 1 at    6km, actuator pitch 0.168m, offset   0, with 7.000000 micron stroke.
    Normalized cubic influence function with inter-actuator coupling of 0.223
  DM 2 at   10km, actuator pitch 0.168m, offset   0, with 7.000000 micron stroke.
    Normalized cubic influence function with inter-actuator coupling of 0.223
[00;00mTomography[00;00m is using Cholesky back solve , integrated tomo.
[00;00mDM Fitting [00;00mis using Cholesky back solve (CBS)
[00;00mThere are 9 fit directions[00;00m
    Fit 0: weight is 0.444, at (   0.00,    0.00) arcsec
    Fit 1: weight is 0.111, at (  15.00,    0.00) arcsec
    Fit 2: weight is 0.111, at (   0.00,   15.00) arcsec
    Fit 3: weight is 0.111, at ( -15.00,    0.00) arcsec
    Fit 4: weight is 0.111, at (   0.00,  -15.00) arcsec
    Fit 5: weight is 0.028, at (  15.00,   15.00) arcsec
    Fit 6: weight is 0.028, at ( -15.00,   15.00) arcsec
    Fit 7: weight is 0.028, at ( -15.00,  -15.00) arcsec
    Fit 8: weight is 0.028, at (  15.00,  -15.00) arcsec
[00;00mThere are 10 evaluation directions[00;00m at sampling 1/128 m.
    Evl 0: weight is 0.100, at (   0.00,    0.00) arcsec
    Evl 1: weight is 0.100, at (   5.00,    0.00) arcsec
    Evl 2: weight is 0.100, at (  10.00,    0.00) arcsec
    Evl 3: weight is 0.100, at (  15.00,    0.00) arcsec
    Evl 4: weight is 0.100, at (  20.00,    0.00) arcsec
    Evl 5: weight is 0.100, at (  25.00,    0.00) arcsec
    Evl 6: weight is 0.100, at (  30.00,    0.00) arcsec
    Evl 7: weight is 0.100, at (  35.00,    0.00) arcsec
    Evl 8: weight is 0.100, at (  45.00,    0.00) arcsec
    Evl 9: weight is 0.100, at (  60.00,    0.00) arcsec
[00;00mSimulation[00;00m start at step 0, end at step 1600, with time step 1/1500s, [01;31mopen loop[00;00m.
After setup_parms:	1.9 MiB.

*** Preparation started at 2024/08/26 12:30:07 in dragon. ***

Using thread pool with 32 threads
Reading aperture amplitude map from KECK.fits
Warning(accphi.c:477): 108578 points not covered by input screen
iwvl 0: Science PSF is using grid size of 2880. The PSF will sum to 6.95167232824563
iwvl 1: Science PSF is using grid size of 2880. The PSF will sum to 6.95167232824563
iwvl 2: Science PSF is using grid size of 2880. The PSF will sum to 6.95167232824563
iwvl 3: Science PSF is using grid size of 2880. The PSF will sum to 6.95167232824563
iwvl 4: Science PSF is using grid size of 2880. The PSF will sum to 6.95167232824563
iwvl 5: Science PSF is using grid size of 2880. The PSF will sum to 6.95167232824563
iwvl 6: Science PSF is using grid size of 2880. The PSF will sum to 6.95167232824563
iwvl 7: Science PSF is using grid size of 2880. The PSF will sum to 6.95167232824563
iwvl 8: Science PSF is using grid size of 2880. The PSF will sum to 6.95167232824563
After setup_aper:	88.0 MiB.

[00;00mSetting up powfs 0 geom[00;00m

There are 20 points in each subaperture of 0.154m.
There are 3148 valid subaperture.

[00;00mSetting up powfs 1 geom[00;00m

There are 88 points in each subaperture of 5.5m.
There are 4 valid subaperture.

[00;00mSetting up powfs 2 geom[00;00m

There are 18 points in each subaperture of 0.563m.
There are 237 valid subaperture.
After setup_powfs_init:	198.9 MiB.

[00;00mSetting up reconstructor geometry.[00;00m

PLOC is 147x147, with sampling of 0.08m (not square)
    DM 0: grid is 75 x 75
    DM 1: grid is 83 x 79
    DM 2: grid is 93 x 85
FLOC is 147x147, with sampling of 0.08m (not square)
Tomography grid is not square:
    layer 0: xloc grid is 147 x 147, sampling is 0.077 m, 17069 points
    layer 1: xloc grid is 147 x 147, sampling is 0.077 m, 17109 points
    layer 2: xloc grid is 147 x 147, sampling is 0.077 m, 17125 points
    layer 3: xloc grid is 147 x 147, sampling is 0.077 m, 17137 points
    layer 4: xloc grid is 148 x 147, sampling is 0.077 m, 17232 points
    layer 5: xloc grid is 148 x 147, sampling is 0.077 m, 17370 points
    layer 6: xloc grid is 149 x 149, sampling is 0.077 m, 17485 points
    layer 7: xloc grid is 150 x 149, sampling is 0.077 m, 17620 points
    layer 8: xloc grid is 150 x 149, sampling is 0.077 m, 17736 points
    layer 9: xloc grid is 153 x 151, sampling is 0.076 m, 18309 points
    layer 10: xloc grid is 181 x 171, sampling is 0.073 m, 24533 points
    layer 11: xloc grid is 212 x 195, sampling is 0.070 m, 32394 points
    layer 12: xloc grid is 249 x 223, sampling is 0.066 m, 43013 points
    layer 13: xloc grid is 333 x 285, sampling is 0.060 m, 70635 points

[00;00mSetting up reconstructor[00;00m

Recon NEA: geom(280.21) geom(280.21) geom(280.21) geom(280.21) geom(280.21) geom(280.21) geom(280.21) geom(280.21) geom(1.57) geom(1.57) geom(1.57) geom(204.68)  mas
Setup or update control matrix parameters.
RRtwfs svd threshold is 1e-10
Before assembling tomo matrix:	941.6 MiB.
Building recon->RR
Building recon->RL
Adding tikhonov constraint of 1.0e-09 to RLM
The maximum eigen value is estimated to be around 1.0e+02
Tomography number of Low rank terms: 16 in RHS, 40 in LHS
